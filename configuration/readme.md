# PostgreSQL configuration

Following configuration is for a 8GB machine with 6 CPU and basic SSD, which is not much, not much at all, but still quite enough for our needs of small websites, with small traffic.

Main configuration is created by [Cybertec PSConfigurator](https://pgconfigurator.cybertec-postgresql.com) and other recommendations from different sources, mainly [PostgreSQLTuner](https://github.com/jfcoz/postgresqltuner).

## Post-installation steps

Run _psql_ commands under _postgres_ account or another superadmin account

>To switch to _postgres_ account run
```
su - postgres
```

### Network binding

> Bind _postgresql_ service to all ip addresses you are planning to use

_postgresql.conf_
```
# to listen on all IP addresses
listen_addresses = *
```

### PostgreSQL Statement statistics

> Install pg_stat_statements for better overview of what queries are running the most and how long they take

Install [pg_stat_statements](https://www.postgresql.org/docs/current/pgstatstatements.html) in _stats_ schema
```
psql -U postgres template1 << EOF
create schema if not exists stats;
create extension pg_stat_statements schema stats;
EOF
```

Configure _postgresql.conf_ to auto load _pg_stat_statements_ extensions

> Based on https://pganalyze.com/docs/install/01_enabling_pg_stat_statements

```
shared_preload_libraries = 'pg_stat_statements'

# Increase the max size of the query strings Postgres records
track_activity_query_size = 2048

# Track statements generated by stored procedures as well
pg_stat_statements.track = all

```

